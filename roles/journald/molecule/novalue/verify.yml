---

- name: Verify
  hosts: molecule
  vars:
    journald_conf_expected: |
      #
      # Ansible managed: Do NOT edit this file manually!
      #

      #  This file is part of systemd.
      #
      #  systemd is free software; you can redistribute it and/or modify it
      #  under the terms of the GNU Lesser General Public License as published by
      #  the Free Software Foundation; either version 2.1 of the License, or
      #  (at your option) any later version.
      #
      # Entries in this file show the compile time defaults.
      # You can change settings by editing this file.
      # Defaults can be restored by simply deleting this file.
      #
      # See journald.conf(5) for details.

      [Journal]
      #Audit=yes
      #Compress=yes
      #ForwardToConsole=no
      #ForwardToKMsg=no
      #ForwardToSyslog=no
      #ForwardToWall=yes
      #LineMax=48K
      #MaxFileSec=1month
      #maxFileSec=1month
      #MaxLevelConsole=info
      #MaxLevelKMsg=notice
      #MaxLevelStore=debug
      #MaxLevelSyslog=debug
      #MaxLevelWall=emerg
      #MaxRetentionSec=
      #RateLimitBurst=10000
      #RateLimitIntervalSec=30s
      #ReadKMsg=yes
      #RuntimeKeepFree=
      #RuntimeMaxFiles=100
      #RuntimeMaxFileSize=
      #RuntimeMaxUse=
      #Seal=yes
      #SplitMode=uid
      #Storage=auto
      #SyncIntervalSec=5m
      #SystemKeepFree=
      #SystemMaxFiles=100
      #SystemMaxFileSize=
      #SystemMaxUse=
      #TTYPath=/dev/console
  tasks:

    - name: Check if config file has been created
      ansible.builtin.copy:  # noqa risky-file-permissions
        content: "{{ journald_conf_expected }}"
        dest: /etc/systemd/journald.conf
      register: journald_conf
      failed_when: journald_conf is changed or journald_conf is failed
